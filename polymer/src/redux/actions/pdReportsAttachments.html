<link rel="import" href="../../../bower_components/promise-polyfill/promise-polyfill-lite.html">

<link rel="import" href="../../constants.html">

<script>
  (function () {
    'use strict';

    App.Actions = App.Actions || {};

    var test;

    App.Actions.PDReportsAttachments = {
      sync: function (attachmentsThunk, reportId) {
        return function (dispatch) {
          dispatch(App.Actions.PDReportsAttachments.loadingStart(reportId));

          return attachmentsThunk()
              .then(function (res) {
                console.log('RES', res);
                if(res.status === 204) {
                  console.log('hello!!!')
                  dispatch(App.Actions.PDReportsAttachments.loadingStop(reportId));
                  dispatch(App.Actions.PDReportsAttachments.set(reportId, res.data));
                }
                else {
                  dispatch(App.Actions.PDReportsAttachments.loadingStop(reportId));
                  dispatch(App.Actions.PDReportsAttachments.set(reportId, res.data));
                }
              })
              .catch(function (err) {
                dispatch(App.Actions.PDReportsAttachments.loadingStop(reportId));

                return Promise.reject(err);
              });
        };
      },

      set: function (reportId, data) {
        if(!data.length) {
          console.log('DATA IS AN OBJECT!');
          console.log('TEST', test);
          test.push(data);
          return {
            type: App.Constants.SET_PD_REPORT_ATTACHMENT,
            reportId: reportId,
            data: test
          };
        }
        else {
          test = data;
          return {
            type: App.Constants.SET_PD_REPORT_ATTACHMENT,
            reportId: reportId,
            data: data
          };
        }
      },

      loadingStart: function (reportId) {
        return {
          type: App.Constants.PD_REPORT_ATTACHMENT_LOADING_START,
          reportId: reportId,
        };
      },

      loadingStop: function (reportId) {
        return {
          type: App.Constants.PD_REPORT_ATTACHMENT_LOADING_STOP,
          reportId: reportId,
        };
      },
    };
  }());
</script>
